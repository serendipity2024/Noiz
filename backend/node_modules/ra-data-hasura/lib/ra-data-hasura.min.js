!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define("ra-data-hasura",[],r):"object"==typeof exports?exports["ra-data-hasura"]=r():e["ra-data-hasura"]=r()}("undefined"!=typeof self?self:this,(function(){return function(e){var r={};function a(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}return a.m=e,a.c=r,a.d=function(e,r,t){a.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,r){if(1&r&&(e=a(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(a.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var n in e)a.d(t,n,function(r){return e[r]}.bind(null,n));return t},a.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(r,"a",r),r},a.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},a.p="",a(a.s=0)}([function(e,r,a){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var t=a(1);var n=function(e){return JSON.parse(JSON.stringify(e))};r.default=function(e,r,a){var s=function(e){var r="id";return a&&a.primaryKey[e]&&(r=a.primaryKey[e]),r},u=function(e,r){if(!r)return e;var a=Object.keys(r);if(0===a.length)return e;var t=Object.assign(e);return a.forEach((function(e){t[e]=r[e]})),t},i=function(e,r,a){var i={},o={},c=function(e){var r,a;if(e&&1===e.split(".").length)a="public",r=e;else{if(!e||2!==e.split(".").length)throw new Error(JSON.stringify({error:"Invalid table/schema resource"}));var t=e.split(".");a=t[0],r=t[1]}return{schema:a,tableName:r}}(r),g=c.schema,l=c.tableName,d=s(r),f={};void 0!==a.data&&Object.keys(a.data).forEach((function(e){"id"!==e&&(f[e]=a.data[e])}));var h,p,y,b=Object.keys(f);switch(b.push(d),void 0!==a.sort&&"id"===a.sort.field&&(a.sort.field=d),e){case"GET_LIST":var m=n(t.selectQuery),w=n(t.countQuery);m.args.table={name:l,schema:g},m.args.limit=a.pagination.perPage,m.args.offset=a.pagination.page*a.pagination.perPage-a.pagination.perPage,m.args.where=a.filter,m.args.order_by={column:a.sort.field,type:void 0===a.sort.order?"asc":a.sort.order.toLowerCase()},w.args.table={name:l,schema:g},w.args.where={},w.args.where[d]={$ne:null},w.args.where=u(w.args.where,a.filter),(o=n(t.bulkQuery)).args.push(m),o.args.push(w);break;case"GET_ONE":(o=n(t.selectQuery)).args.table={name:l,schema:g},o.args.where={},o.args.where[d]={$eq:a.id};break;case"CREATE":(o=n(t.insertQuery)).args.table={name:l,schema:g},o.args.objects.push(f),o.args.returning=b;break;case"UPDATE":(o=n(t.updateQuery)).args.table={name:l,schema:g},o.args.$set=f,o.args.where={},o.args.where[d]={$eq:a.id},o.args.returning=b;break;case"UPDATE_MANY":(o=n(t.updateQuery)).args.table={name:l,schema:g},o.args.$set=f,o.args.where={},o.args.where[d]={$in:a.ids},o.args.returning=b;break;case"DELETE":var E=Object.keys(a.previousData);"id"!==d&&(E=E.filter((function(e){return"id"!==e}))),(o=n(t.deleteQuery)).args.table={name:l,schema:g},o.args.where={},o.args.where[d]={$eq:a.id},E.push(d),o.args.returning=E;break;case"DELETE_MANY":(o=n(t.deleteQuery)).args.table={name:l,schema:g},o.args.where={},o.args.where[d]={$in:a.ids},o.args.returning=[d];break;case"GET_MANY":var v=n(t.selectQuery),Q=n(t.countQuery);v.args.table={name:l,schema:g},v.args.where={},v.args.where[d]={$in:a.ids},v.args.where=u(v.args.where,a.filter),Q.args.table={name:l,schema:g},Q.args.where={},Q.args.where[d]={$ne:null},Q.args.where=u(Q.args.where,a.filter),(o=n(t.bulkQuery)).args.push(v),o.args.push(Q);break;case"GET_MANY_REFERENCE":var _=n(t.selectQuery),O=n(t.countQuery);_.args.table={name:l,schema:g},_.args.limit=a.pagination.perPage,_.args.offset=a.pagination.page*a.pagination.perPage-a.pagination.perPage,_.args.where=(h={},p=a.target,y=a.id,p in h?Object.defineProperty(h,p,{value:y,enumerable:!0,configurable:!0,writable:!0}):h[p]=y,h),_.args.where=u(_.args.where,a.filter),_.args.order_by={column:a.sort.field,type:void 0===a.sort.order?"asc":a.sort.order.toLowerCase()},O.args.table={name:l,schema:g},O.args.where={},O.args.where[d]={$ne:null},O.args.where=u(_.args.where,a.filter),(o=n(t.bulkQuery)).args.push(_),o.args.push(O);break;default:throw new Error("Unsupported type ".concat(e))}return i.body=JSON.stringify(o),{options:i}},o=function(e,r,a,t){if("error"in e||"code"in e)throw new Error(JSON.stringify(e));var n=s(a),u=e;switch("returning"in e&&(u=e.returning),"id"!==n&&(Array.isArray(e[0])?u[0].forEach((function(e){e.id=e[n]})):u[0].id=u[0][n]),r){case"GET_LIST":return{data:e[0],total:e[1].count};case"GET_ONE":return{data:e[0]};case"CREATE":case"UPDATE":return{data:e.returning[0]};case"UPDATE_MANY":return{data:e.returning.map((function(e){return e.id}))};case"DELETE":return{data:e.returning[0]};case"DELETE_MANY":return{data:e.returning.map((function(e){return e.id}))};case"GET_MANY":return{data:e[0]};case"GET_MANY_REFERENCE":return{data:e[0],total:e[1].count};default:return{data:e}}};return function(a,t,n){var s=i(a,t,n).options;return s.method="POST","function"==typeof r?r(e+"/v1/query",s).then((function(e){return o(e.json,a,t)})):(s.headers=r,fetch(e+"/v1/query",s).then((function(e){return e.json().then((function(e){return o(e,a,t)}))})))}},e.exports=r.default},function(e,r,a){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.deleteQuery=r.updateQuery=r.insertQuery=r.countQuery=r.selectQuery=r.bulkQuery=void 0;r.bulkQuery={type:"bulk",args:[]};r.selectQuery={type:"select",args:{table:{schema:"",name:""},columns:["*"]}};r.countQuery={type:"count",args:{table:{schema:"",name:""},where:{}}};r.insertQuery={type:"insert",args:{table:{schema:"",name:""},objects:[],returning:[]}};r.updateQuery={type:"update",args:{table:{schema:"",name:""},$set:{},where:{},returning:[]}};r.deleteQuery={type:"delete",args:{table:{schema:"",name:""},$set:{},where:{},returning:[]}}}])}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9yYS1kYXRhLWhhc3VyYS93ZWJwYWNrL3VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24iLCJ3ZWJwYWNrOi8vcmEtZGF0YS1oYXN1cmEvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vcmEtZGF0YS1oYXN1cmEvLi9zcmMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vcmEtZGF0YS1oYXN1cmEvLi9zcmMvcXVlcmllcy5qcyJdLCJuYW1lcyI6WyJyb290IiwiZmFjdG9yeSIsImV4cG9ydHMiLCJtb2R1bGUiLCJkZWZpbmUiLCJhbWQiLCJzZWxmIiwidGhpcyIsImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJpIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsInQiLCJtb2RlIiwiX19lc01vZHVsZSIsIm5zIiwiY3JlYXRlIiwia2V5IiwiYmluZCIsIm4iLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJjbG9uZVF1ZXJ5IiwicXVlcnkiLCJKU09OIiwicGFyc2UiLCJzdHJpbmdpZnkiLCJzZXJ2ZXJFbmRwb2ludCIsImh0dHBDbGllbnQiLCJjb25maWciLCJnZXRQcmltYXJ5S2V5IiwicmVzb3VyY2UiLCJwcmltYXJ5S2V5IiwiYWRkRmlsdGVycyIsIndoZXJlIiwiZmlsdGVyIiwiZmlsdGVyS2V5cyIsImtleXMiLCJsZW5ndGgiLCJ3aGVyZUNvcHkiLCJhc3NpZ24iLCJmb3JFYWNoIiwiY29udmVydERhdGFSZXF1ZXN0VG9IVFRQIiwidHlwZSIsInBhcmFtcyIsIm9wdGlvbnMiLCJmaW5hbFF1ZXJ5IiwidGFibGVTY2hlbWEiLCJ0YWJsZU5hbWUiLCJzY2hlbWEiLCJzcGxpdCIsIkVycm9yIiwicmVzb3VyY2VTcGxpdCIsImdldFRhYmxlU2NoZW1hIiwiZmlsdGVyZWREYXRhIiwidW5kZWZpbmVkIiwiZGF0YSIsImZpZWxkIiwiZmlsdGVyZWRLZXlzIiwicHVzaCIsInNvcnQiLCJmaW5hbFNlbGVjdFF1ZXJ5IiwiZmluYWxDb3VudFF1ZXJ5IiwiYXJncyIsInRhYmxlIiwibGltaXQiLCJwYWdpbmF0aW9uIiwicGVyUGFnZSIsIm9mZnNldCIsInBhZ2UiLCJvcmRlcl9ieSIsImNvbHVtbiIsIm9yZGVyIiwidG9Mb3dlckNhc2UiLCJpZCIsIm9iamVjdHMiLCJyZXR1cm5pbmciLCJpZHMiLCJkZWxldGVGaWVsZHMiLCJwcmV2aW91c0RhdGEiLCJmaW5hbE1hbnlRdWVyeSIsImZpbmFsTWFueUNvdW50UXVlcnkiLCJmaW5hbE1hbnlSZWZRdWVyeSIsImZpbmFsTWFueVJlZkNvdW50UXVlcnkiLCJ0YXJnZXQiLCJib2R5IiwiY29udmVydEhUVFBSZXNwb25zZSIsInJlc3BvbnNlIiwicmV0dXJuZWRSZXNwb25zZSIsIkFycmF5IiwiaXNBcnJheSIsInJlcyIsInRvdGFsIiwibWFwIiwiaXRlbSIsImNvdW50IiwibWV0aG9kIiwidGhlbiIsImpzb24iLCJoZWFkZXJzIiwiZmV0Y2giLCJjb2x1bW5zIiwiJHNldCJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBMkNBLEVBQU1DLEdBQzFCLGlCQUFaQyxTQUEwQyxpQkFBWEMsT0FDeENBLE9BQU9ELFFBQVVELElBQ1EsbUJBQVhHLFFBQXlCQSxPQUFPQyxJQUM5Q0QsT0FBTyxpQkFBa0IsR0FBSUgsR0FDSCxpQkFBWkMsUUFDZEEsUUFBUSxrQkFBb0JELElBRTVCRCxFQUFLLGtCQUFvQkMsSUFSM0IsQ0FTbUIsb0JBQVRLLEtBQXVCQSxLQUFPQyxNQUFNLFdBQzlDLE8sWUNURSxJQUFJQyxFQUFtQixHQUd2QixTQUFTQyxFQUFvQkMsR0FHNUIsR0FBR0YsRUFBaUJFLEdBQ25CLE9BQU9GLEVBQWlCRSxHQUFVUixR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WixFQUNBYSxHQUhNQyxRQU9SLE9BREFBLEVBQVFtRCxPQUFTLE9BQ1csbUJBQWhCcEUsRUFDSEEsRUFBV0QsRUFBaUIsWUFBYWtCLEdBQVNvRCxNQUFLLFNBQUFWLEdBQVEsT0FDcEVELEVBQW9CQyxFQUFTVyxLQUFNdkQsRUFBTVosT0FJN0NjLEVBQVFzRCxRQUFVdkUsRUFDWHdFLE1BQU16RSxFQUFpQixZQUFha0IsR0FBU29ELE1BQUssU0FBVVYsR0FDakUsT0FBT0EsRUFBU1csT0FBT0QsTUFBSyxTQUFDekMsR0FDM0IsT0FBTzhCLEVBQW9COUIsRUFBTWIsRUFBTVosWSx1TUNuUzdCLENBQ2hCWSxLQUFNLE9BQ05vQixLQUFNLEksY0FHWSxDQUNsQnBCLEtBQU0sU0FDTm9CLEtBQU0sQ0FDSkMsTUFBTyxDQUFDLE9BQVUsR0FBSSxLQUFRLElBQzlCcUMsUUFBUyxDQUFDLE8sYUFJSyxDQUNqQjFELEtBQU0sUUFDTm9CLEtBQU0sQ0FDSkMsTUFBTyxDQUFDLE9BQVUsR0FBSSxLQUFRLElBQzlCOUIsTUFBTyxLLGNBSVMsQ0FDbEJTLEtBQU0sU0FDTm9CLEtBQU0sQ0FDSkMsTUFBTyxDQUFDLE9BQVUsR0FBSSxLQUFRLElBQzlCVyxRQUFTLEdBQ1RDLFVBQVcsSyxjQUlLLENBQ2xCakMsS0FBTSxTQUNOb0IsS0FBTSxDQUNKQyxNQUFPLENBQUMsT0FBVSxHQUFJLEtBQVEsSUFDOUJzQyxLQUFNLEdBQ05wRSxNQUFPLEdBQ1AwQyxVQUFXLEssY0FJSyxDQUNsQmpDLEtBQU0sU0FDTm9CLEtBQU0sQ0FDSkMsTUFBTyxDQUFDLE9BQVUsR0FBSSxLQUFRLElBQzlCc0MsS0FBTSxHQUNOcEUsTUFBTyxHQUNQMEMsVUFBVyIsImZpbGUiOiJyYS1kYXRhLWhhc3VyYS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge1xuXHRpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG5cdGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKVxuXHRcdGRlZmluZShcInJhLWRhdGEtaGFzdXJhXCIsIFtdLCBmYWN0b3J5KTtcblx0ZWxzZSBpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpXG5cdFx0ZXhwb3J0c1tcInJhLWRhdGEtaGFzdXJhXCJdID0gZmFjdG9yeSgpO1xuXHRlbHNlXG5cdFx0cm9vdFtcInJhLWRhdGEtaGFzdXJhXCJdID0gZmFjdG9yeSgpO1xufSkodHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHRoaXMsIGZ1bmN0aW9uKCkge1xucmV0dXJuICIsIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsImltcG9ydCB7XG4gIGJ1bGtRdWVyeSxcbiAgc2VsZWN0UXVlcnksXG4gIGNvdW50UXVlcnksXG4gIGluc2VydFF1ZXJ5LFxuICB1cGRhdGVRdWVyeSxcbiAgZGVsZXRlUXVlcnlcbn0gZnJvbSAnLi9xdWVyaWVzJztcblxuY29uc3QgREVGQVVMVF9QUklNQVJZX0tFWSA9ICdpZCc7XG5cbmNvbnN0IGNsb25lUXVlcnkgPSAocXVlcnkpID0+IHtcbiAgcmV0dXJuIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkocXVlcnkpKTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IChzZXJ2ZXJFbmRwb2ludCwgaHR0cENsaWVudCwgY29uZmlnKSA9PiB7XG5cbiAgY29uc3QgZ2V0VGFibGVTY2hlbWEgPSAocmVzb3VyY2UpID0+IHtcbiAgICBsZXQgdGFibGVOYW1lO1xuICAgIGxldCBzY2hlbWE7XG5cbiAgICAvLyBwYXJzZSBzY2hlbWEgaW4gcmVzb3VyY2VcbiAgICBpZiAocmVzb3VyY2UgJiYgcmVzb3VyY2Uuc3BsaXQoJy4nKS5sZW5ndGggPT09IDEpIHtcbiAgICAgIHNjaGVtYSA9ICdwdWJsaWMnO1xuICAgICAgdGFibGVOYW1lID0gcmVzb3VyY2U7XG4gICAgfSBlbHNlIGlmIChyZXNvdXJjZSAmJiByZXNvdXJjZS5zcGxpdCgnLicpLmxlbmd0aCA9PT0gMikge1xuICAgICAgY29uc3QgcmVzb3VyY2VTcGxpdCA9IHJlc291cmNlLnNwbGl0KCcuJyk7XG5cbiAgICAgIHNjaGVtYSA9IHJlc291cmNlU3BsaXRbMF07XG4gICAgICB0YWJsZU5hbWUgPSByZXNvdXJjZVNwbGl0WzFdO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoSlNPTi5zdHJpbmdpZnkoeyAnZXJyb3InOiAnSW52YWxpZCB0YWJsZS9zY2hlbWEgcmVzb3VyY2UnIH0pKTtcbiAgICB9XG4gICAgcmV0dXJuIHsgc2NoZW1hLCB0YWJsZU5hbWUgfTtcbiAgfTtcblxuICBjb25zdCBnZXRQcmltYXJ5S2V5ID0gKHJlc291cmNlKSA9PiB7XG4gICAgbGV0IHByaW1hcnlLZXkgPSBERUZBVUxUX1BSSU1BUllfS0VZO1xuXG4gICAgaWYgKGNvbmZpZyAmJiBjb25maWdbJ3ByaW1hcnlLZXknXVtyZXNvdXJjZV0pIHtcbiAgICAgIHByaW1hcnlLZXkgPSBjb25maWdbJ3ByaW1hcnlLZXknXVtyZXNvdXJjZV07XG4gICAgfVxuICAgIHJldHVybiBwcmltYXJ5S2V5O1xuICB9O1xuXG4gIGNvbnN0IGFkZEZpbHRlcnMgPSAod2hlcmUsIGZpbHRlcikgPT4ge1xuICAgIGlmICghZmlsdGVyKSByZXR1cm4gd2hlcmU7XG5cbiAgICBjb25zdCBmaWx0ZXJLZXlzID0gT2JqZWN0LmtleXMoZmlsdGVyKTtcblxuICAgIGlmIChmaWx0ZXJLZXlzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIHdoZXJlO1xuXG4gICAgY29uc3Qgd2hlcmVDb3B5ID0gT2JqZWN0LmFzc2lnbih3aGVyZSk7XG5cbiAgICBmaWx0ZXJLZXlzLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgd2hlcmVDb3B5W2tleV0gPSBmaWx0ZXJba2V5XTtcbiAgICB9KTtcbiAgICByZXR1cm4gd2hlcmVDb3B5O1xuICB9O1xuXG4gIGNvbnN0IGNvbnZlcnREYXRhUmVxdWVzdFRvSFRUUCA9ICh0eXBlLCByZXNvdXJjZSwgcGFyYW1zKSA9PiB7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHt9O1xuICAgIGxldCBmaW5hbFF1ZXJ5ID0ge307XG5cbiAgICBjb25zdCB0YWJsZVNjaGVtYSA9IGdldFRhYmxlU2NoZW1hKHJlc291cmNlKTtcblxuICAgIGxldCB7IHNjaGVtYSwgdGFibGVOYW1lIH0gPSB0YWJsZVNjaGVtYTtcblxuICAgIGNvbnN0IHByaW1hcnlLZXkgPSBnZXRQcmltYXJ5S2V5KHJlc291cmNlKTtcblxuICAgIGNvbnN0IGZpbHRlcmVkRGF0YSA9IHt9O1xuICAgIGlmIChwYXJhbXMuZGF0YSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBPYmplY3Qua2V5cyhwYXJhbXMuZGF0YSkuZm9yRWFjaChmaWVsZCA9PiB7XG4gICAgICAgIGlmIChmaWVsZCAhPT0gREVGQVVMVF9QUklNQVJZX0tFWSkge1xuICAgICAgICAgIGZpbHRlcmVkRGF0YVtmaWVsZF0gPSBwYXJhbXMuZGF0YVtmaWVsZF07XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfVxuICAgIGNvbnN0IGZpbHRlcmVkS2V5cyA9IE9iamVjdC5rZXlzKGZpbHRlcmVkRGF0YSk7XG4gICAgZmlsdGVyZWRLZXlzLnB1c2gocHJpbWFyeUtleSk7XG5cbiAgICBpZiAocGFyYW1zLnNvcnQgIT09IHVuZGVmaW5lZCAmJiBwYXJhbXMuc29ydC5maWVsZCA9PT0gREVGQVVMVF9QUklNQVJZX0tFWSkge1xuICAgICAgcGFyYW1zLnNvcnQuZmllbGQgPSBwcmltYXJ5S2V5O1xuICAgIH1cblxuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgY2FzZSAnR0VUX0xJU1QnOlxuICAgICAgICAvLyBzZWxlY3QgbXVsdGlwbGVcbiAgICAgICAgY29uc3QgZmluYWxTZWxlY3RRdWVyeSA9IGNsb25lUXVlcnkoc2VsZWN0UXVlcnkpO1xuICAgICAgICBjb25zdCBmaW5hbENvdW50UXVlcnkgPSBjbG9uZVF1ZXJ5KGNvdW50UXVlcnkpO1xuXG4gICAgICAgIGZpbmFsU2VsZWN0UXVlcnkuYXJncy50YWJsZSA9IHsgJ25hbWUnOiB0YWJsZU5hbWUsICdzY2hlbWEnOiBzY2hlbWEgfTtcbiAgICAgICAgZmluYWxTZWxlY3RRdWVyeS5hcmdzLmxpbWl0ID0gcGFyYW1zLnBhZ2luYXRpb24ucGVyUGFnZTtcbiAgICAgICAgZmluYWxTZWxlY3RRdWVyeS5hcmdzLm9mZnNldCA9IChwYXJhbXMucGFnaW5hdGlvbi5wYWdlICogcGFyYW1zLnBhZ2luYXRpb24ucGVyUGFnZSkgLSBwYXJhbXMucGFnaW5hdGlvbi5wZXJQYWdlO1xuICAgICAgICBmaW5hbFNlbGVjdFF1ZXJ5LmFyZ3Mud2hlcmUgPSBwYXJhbXMuZmlsdGVyO1xuICAgICAgICBmaW5hbFNlbGVjdFF1ZXJ5LmFyZ3Mub3JkZXJfYnkgPSB7IGNvbHVtbjogcGFyYW1zLnNvcnQuZmllbGQsIHR5cGU6IHR5cGVvZiBwYXJhbXMuc29ydC5vcmRlciA9PT0gJ3VuZGVmaW5lZCcgPyAnYXNjJyA6IHBhcmFtcy5zb3J0Lm9yZGVyLnRvTG93ZXJDYXNlKCkgfTtcbiAgICAgICAgZmluYWxDb3VudFF1ZXJ5LmFyZ3MudGFibGUgPSB7ICduYW1lJzogdGFibGVOYW1lLCAnc2NoZW1hJzogc2NoZW1hIH07O1xuICAgICAgICBmaW5hbENvdW50UXVlcnkuYXJncy53aGVyZSA9IHt9O1xuICAgICAgICBmaW5hbENvdW50UXVlcnkuYXJncy53aGVyZVtwcmltYXJ5S2V5XSA9IHsgJyRuZSc6IG51bGwgfTtcbiAgICAgICAgZmluYWxDb3VudFF1ZXJ5LmFyZ3Mud2hlcmUgPSBhZGRGaWx0ZXJzKGZpbmFsQ291bnRRdWVyeS5hcmdzLndoZXJlLCBwYXJhbXMuZmlsdGVyKTtcbiAgICAgICAgZmluYWxRdWVyeSA9IGNsb25lUXVlcnkoYnVsa1F1ZXJ5KTtcbiAgICAgICAgZmluYWxRdWVyeS5hcmdzLnB1c2goZmluYWxTZWxlY3RRdWVyeSk7XG4gICAgICAgIGZpbmFsUXVlcnkuYXJncy5wdXNoKGZpbmFsQ291bnRRdWVyeSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnR0VUX09ORSc6XG4gICAgICAgIC8vIHNlbGVjdCBvbmVcbiAgICAgICAgZmluYWxRdWVyeSA9IGNsb25lUXVlcnkoc2VsZWN0UXVlcnkpO1xuICAgICAgICBmaW5hbFF1ZXJ5LmFyZ3MudGFibGUgPSB7ICduYW1lJzogdGFibGVOYW1lLCAnc2NoZW1hJzogc2NoZW1hIH07XG4gICAgICAgIGZpbmFsUXVlcnkuYXJncy53aGVyZSA9IHt9O1xuICAgICAgICBmaW5hbFF1ZXJ5LmFyZ3Mud2hlcmVbcHJpbWFyeUtleV0gPSB7ICckZXEnOiBwYXJhbXMuaWQgfTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdDUkVBVEUnOlxuICAgICAgICAvLyBjcmVhdGUgb25lXG4gICAgICAgIGZpbmFsUXVlcnkgPSBjbG9uZVF1ZXJ5KGluc2VydFF1ZXJ5KTtcbiAgICAgICAgZmluYWxRdWVyeS5hcmdzLnRhYmxlID0geyduYW1lJzogdGFibGVOYW1lLCAnc2NoZW1hJzogc2NoZW1hfTtcbiAgICAgICAgZmluYWxRdWVyeS5hcmdzLm9iamVjdHMucHVzaChmaWx0ZXJlZERhdGEpO1xuICAgICAgICBmaW5hbFF1ZXJ5LmFyZ3MucmV0dXJuaW5nID0gZmlsdGVyZWRLZXlzO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ1VQREFURSc6XG4gICAgICAgIC8vIHVwZGF0ZSBvbmVcbiAgICAgICAgZmluYWxRdWVyeSA9IGNsb25lUXVlcnkodXBkYXRlUXVlcnkpO1xuICAgICAgICBmaW5hbFF1ZXJ5LmFyZ3MudGFibGUgPSB7J25hbWUnOiB0YWJsZU5hbWUsICdzY2hlbWEnOiBzY2hlbWF9O1xuICAgICAgICBmaW5hbFF1ZXJ5LmFyZ3NbJyRzZXQnXSA9IGZpbHRlcmVkRGF0YTtcbiAgICAgICAgZmluYWxRdWVyeS5hcmdzLndoZXJlID0ge307XG4gICAgICAgIGZpbmFsUXVlcnkuYXJncy53aGVyZVtwcmltYXJ5S2V5XSA9IHsgJyRlcSc6IHBhcmFtcy5pZCB9O1xuICAgICAgICBmaW5hbFF1ZXJ5LmFyZ3MucmV0dXJuaW5nID0gZmlsdGVyZWRLZXlzO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ1VQREFURV9NQU5ZJzpcbiAgICAgICAgLy8gdXBkYXRlIG11bHRpcGxlIGlkcyB3aXRoIGdpdmVuIGRhdGFcbiAgICAgICAgZmluYWxRdWVyeSA9IGNsb25lUXVlcnkodXBkYXRlUXVlcnkpO1xuICAgICAgICBmaW5hbFF1ZXJ5LmFyZ3MudGFibGUgPSB7J25hbWUnOiB0YWJsZU5hbWUsICdzY2hlbWEnOiBzY2hlbWF9O1xuICAgICAgICBmaW5hbFF1ZXJ5LmFyZ3NbJyRzZXQnXSA9IGZpbHRlcmVkRGF0YTtcbiAgICAgICAgZmluYWxRdWVyeS5hcmdzLndoZXJlID0ge307XG4gICAgICAgIGZpbmFsUXVlcnkuYXJncy53aGVyZVtwcmltYXJ5S2V5XSA9IHsgJyRpbic6IHBhcmFtcy5pZHMgfTtcbiAgICAgICAgZmluYWxRdWVyeS5hcmdzLnJldHVybmluZyA9IGZpbHRlcmVkS2V5cztcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdERUxFVEUnOlxuICAgICAgICAvLyBkZWxldGUgb25lXG4gICAgICAgIGxldCBkZWxldGVGaWVsZHMgPSBPYmplY3Qua2V5cyhwYXJhbXMucHJldmlvdXNEYXRhKTtcbiAgICAgICAgaWYgKHByaW1hcnlLZXkgIT09IERFRkFVTFRfUFJJTUFSWV9LRVkpIHtcbiAgICAgICAgICBkZWxldGVGaWVsZHMgPSBkZWxldGVGaWVsZHMuZmlsdGVyKGZpZWxkID0+IGZpZWxkICE9PSBERUZBVUxUX1BSSU1BUllfS0VZKVxuICAgICAgICB9XG5cbiAgICAgICAgZmluYWxRdWVyeSA9IGNsb25lUXVlcnkoZGVsZXRlUXVlcnkpO1xuICAgICAgICBmaW5hbFF1ZXJ5LmFyZ3MudGFibGUgPSB7ICduYW1lJzogdGFibGVOYW1lLCAnc2NoZW1hJzogc2NoZW1hIH07XG4gICAgICAgIGZpbmFsUXVlcnkuYXJncy53aGVyZSA9IHt9O1xuICAgICAgICBmaW5hbFF1ZXJ5LmFyZ3Mud2hlcmVbcHJpbWFyeUtleV0gPSB7ICckZXEnOiBwYXJhbXMuaWQgfTtcbiAgICAgICAgZGVsZXRlRmllbGRzLnB1c2gocHJpbWFyeUtleSk7XG4gICAgICAgIGZpbmFsUXVlcnkuYXJncy5yZXR1cm5pbmcgPSBkZWxldGVGaWVsZHM7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnREVMRVRFX01BTlknOlxuICAgICAgICAvLyBkZWxldGUgbXVsdGlwbGVcbiAgICAgICAgZmluYWxRdWVyeSA9IGNsb25lUXVlcnkoZGVsZXRlUXVlcnkpO1xuICAgICAgICBmaW5hbFF1ZXJ5LmFyZ3MudGFibGUgPSB7ICduYW1lJzogdGFibGVOYW1lLCAnc2NoZW1hJzogc2NoZW1hIH07XG4gICAgICAgIGZpbmFsUXVlcnkuYXJncy53aGVyZSA9IHt9O1xuICAgICAgICBmaW5hbFF1ZXJ5LmFyZ3Mud2hlcmVbcHJpbWFyeUtleV0gPSB7ICckaW4nOiBwYXJhbXMuaWRzIH07XG4gICAgICAgIGZpbmFsUXVlcnkuYXJncy5yZXR1cm5pbmcgPSBbcHJpbWFyeUtleV07XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnR0VUX01BTlknOlxuICAgICAgICAvLyBzZWxlY3QgbXVsdGlwbGUgd2l0aGluIHdoZXJlIGNsYXVzZVxuICAgICAgICBjb25zdCBmaW5hbE1hbnlRdWVyeSA9IGNsb25lUXVlcnkoc2VsZWN0UXVlcnkpO1xuICAgICAgICBjb25zdCBmaW5hbE1hbnlDb3VudFF1ZXJ5ID0gY2xvbmVRdWVyeShjb3VudFF1ZXJ5KTtcblxuICAgICAgICBmaW5hbE1hbnlRdWVyeS5hcmdzLnRhYmxlID0geyAnbmFtZSc6IHRhYmxlTmFtZSwgJ3NjaGVtYSc6IHNjaGVtYSB9O1xuICAgICAgICBmaW5hbE1hbnlRdWVyeS5hcmdzLndoZXJlID0ge307XG4gICAgICAgIGZpbmFsTWFueVF1ZXJ5LmFyZ3Mud2hlcmVbcHJpbWFyeUtleV0gPSB7ICckaW4nOiBwYXJhbXMuaWRzIH07XG4gICAgICAgIGZpbmFsTWFueVF1ZXJ5LmFyZ3Mud2hlcmUgPSBhZGRGaWx0ZXJzKGZpbmFsTWFueVF1ZXJ5LmFyZ3Mud2hlcmUsIHBhcmFtcy5maWx0ZXIpO1xuXG4gICAgICAgIGZpbmFsTWFueUNvdW50UXVlcnkuYXJncy50YWJsZSA9IHsgJ25hbWUnOiB0YWJsZU5hbWUsICdzY2hlbWEnOiBzY2hlbWEgfTs7XG4gICAgICAgIGZpbmFsTWFueUNvdW50UXVlcnkuYXJncy53aGVyZSA9IHt9O1xuICAgICAgICBmaW5hbE1hbnlDb3VudFF1ZXJ5LmFyZ3Mud2hlcmVbcHJpbWFyeUtleV0gPSB7ICckbmUnOiBudWxsIH07XG4gICAgICAgIGZpbmFsTWFueUNvdW50UXVlcnkuYXJncy53aGVyZSA9IGFkZEZpbHRlcnMoZmluYWxNYW55Q291bnRRdWVyeS5hcmdzLndoZXJlLCBwYXJhbXMuZmlsdGVyKTtcblxuICAgICAgICBmaW5hbFF1ZXJ5ID0gY2xvbmVRdWVyeShidWxrUXVlcnkpO1xuICAgICAgICBmaW5hbFF1ZXJ5LmFyZ3MucHVzaChmaW5hbE1hbnlRdWVyeSk7XG4gICAgICAgIGZpbmFsUXVlcnkuYXJncy5wdXNoKGZpbmFsTWFueUNvdW50UXVlcnkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ0dFVF9NQU5ZX1JFRkVSRU5DRSc6XG4gICAgICAgIC8vIHNlbGVjdCBtdWx0aXBsZSB3aXRoIHJlbGF0aW9uc1xuICAgICAgICBjb25zdCBmaW5hbE1hbnlSZWZRdWVyeSA9IGNsb25lUXVlcnkoc2VsZWN0UXVlcnkpO1xuICAgICAgICBjb25zdCBmaW5hbE1hbnlSZWZDb3VudFF1ZXJ5ID0gY2xvbmVRdWVyeShjb3VudFF1ZXJ5KTtcblxuICAgICAgICBmaW5hbE1hbnlSZWZRdWVyeS5hcmdzLnRhYmxlID0geyAnbmFtZSc6IHRhYmxlTmFtZSwgJ3NjaGVtYSc6IHNjaGVtYSB9O1xuICAgICAgICBmaW5hbE1hbnlSZWZRdWVyeS5hcmdzLmxpbWl0ID0gcGFyYW1zLnBhZ2luYXRpb24ucGVyUGFnZTtcbiAgICAgICAgZmluYWxNYW55UmVmUXVlcnkuYXJncy5vZmZzZXQgPSAocGFyYW1zLnBhZ2luYXRpb24ucGFnZSAqIHBhcmFtcy5wYWdpbmF0aW9uLnBlclBhZ2UpIC0gcGFyYW1zLnBhZ2luYXRpb24ucGVyUGFnZTtcbiAgICAgICAgZmluYWxNYW55UmVmUXVlcnkuYXJncy53aGVyZSA9IHsgW3BhcmFtcy50YXJnZXRdOiBwYXJhbXMuaWQgfTtcbiAgICAgICAgZmluYWxNYW55UmVmUXVlcnkuYXJncy53aGVyZSA9IGFkZEZpbHRlcnMoZmluYWxNYW55UmVmUXVlcnkuYXJncy53aGVyZSwgcGFyYW1zLmZpbHRlcik7XG4gICAgICAgIGZpbmFsTWFueVJlZlF1ZXJ5LmFyZ3Mub3JkZXJfYnkgPSB7IGNvbHVtbjogcGFyYW1zLnNvcnQuZmllbGQsIHR5cGU6IHR5cGVvZiBwYXJhbXMuc29ydC5vcmRlciA9PT0gJ3VuZGVmaW5lZCcgPyAnYXNjJyA6IHBhcmFtcy5zb3J0Lm9yZGVyLnRvTG93ZXJDYXNlKCkgfTtcbiAgICAgICAgZmluYWxNYW55UmVmQ291bnRRdWVyeS5hcmdzLnRhYmxlID0geyAnbmFtZSc6IHRhYmxlTmFtZSwgJ3NjaGVtYSc6IHNjaGVtYSB9OztcbiAgICAgICAgZmluYWxNYW55UmVmQ291bnRRdWVyeS5hcmdzLndoZXJlID0ge307XG4gICAgICAgIGZpbmFsTWFueVJlZkNvdW50UXVlcnkuYXJncy53aGVyZVtwcmltYXJ5S2V5XSA9IHsgJyRuZSc6IG51bGwgfTtcbiAgICAgICAgZmluYWxNYW55UmVmQ291bnRRdWVyeS5hcmdzLndoZXJlID0gYWRkRmlsdGVycyhmaW5hbE1hbnlSZWZRdWVyeS5hcmdzLndoZXJlLCBwYXJhbXMuZmlsdGVyKTtcbiAgICAgICAgZmluYWxRdWVyeSA9IGNsb25lUXVlcnkoYnVsa1F1ZXJ5KTtcbiAgICAgICAgZmluYWxRdWVyeS5hcmdzLnB1c2goZmluYWxNYW55UmVmUXVlcnkpO1xuICAgICAgICBmaW5hbFF1ZXJ5LmFyZ3MucHVzaChmaW5hbE1hbnlSZWZDb3VudFF1ZXJ5KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuc3VwcG9ydGVkIHR5cGUgJHt0eXBlfWApO1xuICAgIH07XG4gICAgb3B0aW9ucy5ib2R5ID0gSlNPTi5zdHJpbmdpZnkoZmluYWxRdWVyeSk7XG4gICAgcmV0dXJuIHsgb3B0aW9ucyB9O1xuICB9O1xuXG4gIGNvbnN0IGNvbnZlcnRIVFRQUmVzcG9uc2UgPSAocmVzcG9uc2UsIHR5cGUsIHJlc291cmNlLCBwYXJhbXMpID0+IHtcbiAgICAvLyBoYW5kbGUgZXJyb3JzIGFuZCB0aHJvdyB3aXRoIHRoZSBtZXNzYWdlXG4gICAgaWYgKCdlcnJvcicgaW4gcmVzcG9uc2UgfHwgJ2NvZGUnIGluIHJlc3BvbnNlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UpKTtcbiAgICB9XG4gICAgY29uc3QgcHJpbWFyeUtleSA9IGdldFByaW1hcnlLZXkocmVzb3VyY2UpO1xuXG4gICAgbGV0IHJldHVybmVkUmVzcG9uc2UgPSByZXNwb25zZTtcbiAgICBpZiAoJ3JldHVybmluZycgaW4gcmVzcG9uc2UpIHtcbiAgICAgIHJldHVybmVkUmVzcG9uc2UgPSByZXNwb25zZS5yZXR1cm5pbmc7XG4gICAgfVxuICAgIGlmIChwcmltYXJ5S2V5ICE9PSBERUZBVUxUX1BSSU1BUllfS0VZKSB7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShyZXNwb25zZVswXSkpIHtcbiAgICAgICAgcmV0dXJuZWRSZXNwb25zZVswXS5mb3JFYWNoKChyZXMpID0+IHtcbiAgICAgICAgICByZXNbREVGQVVMVF9QUklNQVJZX0tFWV0gPSByZXNbcHJpbWFyeUtleV07XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuZWRSZXNwb25zZVswXVtERUZBVUxUX1BSSU1BUllfS0VZXSA9IHJldHVybmVkUmVzcG9uc2VbMF1bcHJpbWFyeUtleV07XG4gICAgICB9XG4gICAgfVxuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgY2FzZSAnR0VUX0xJU1QnOlxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGRhdGE6IHJlc3BvbnNlWzBdLFxuICAgICAgICAgIHRvdGFsOiByZXNwb25zZVsxXVsnY291bnQnXVxuICAgICAgICB9O1xuICAgICAgY2FzZSAnR0VUX09ORSc6XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZGF0YTogcmVzcG9uc2VbMF1cbiAgICAgICAgfTtcbiAgICAgIGNhc2UgJ0NSRUFURSc6XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZGF0YTogcmVzcG9uc2UucmV0dXJuaW5nWzBdXG4gICAgICAgIH07XG4gICAgICBjYXNlICdVUERBVEUnOlxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGRhdGE6IHJlc3BvbnNlLnJldHVybmluZ1swXVxuICAgICAgICB9O1xuICAgICAgY2FzZSAnVVBEQVRFX01BTlknOlxuICAgICAgICBjb25zdCB1cGRhdGVkSWRzID0gcmVzcG9uc2UucmV0dXJuaW5nLm1hcCgoaXRlbSkgPT4ge1xuICAgICAgICAgIHJldHVybiBpdGVtLmlkO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGRhdGE6IHVwZGF0ZWRJZHNcbiAgICAgICAgfTtcbiAgICAgIGNhc2UgJ0RFTEVURSc6XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZGF0YTogcmVzcG9uc2UucmV0dXJuaW5nWzBdXG4gICAgICAgIH07XG4gICAgICBjYXNlICdERUxFVEVfTUFOWSc6XG4gICAgICAgIGNvbnN0IGRlbGV0ZWRJZHMgPSByZXNwb25zZS5yZXR1cm5pbmcubWFwKChpdGVtKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGl0ZW0uaWQ7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZGF0YTogZGVsZXRlZElkc1xuICAgICAgICB9O1xuICAgICAgY2FzZSAnR0VUX01BTlknOlxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGRhdGE6IHJlc3BvbnNlWzBdXG4gICAgICAgIH07XG4gICAgICBjYXNlICdHRVRfTUFOWV9SRUZFUkVOQ0UnOlxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGRhdGE6IHJlc3BvbnNlWzBdLFxuICAgICAgICAgIHRvdGFsOiByZXNwb25zZVsxXS5jb3VudFxuICAgICAgICB9O1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIHsgZGF0YTogcmVzcG9uc2UgfTtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuICh0eXBlLCByZXNvdXJjZSwgcGFyYW1zKSA9PiB7XG4gICAgY29uc3QgeyBvcHRpb25zIH0gPSBjb252ZXJ0RGF0YVJlcXVlc3RUb0hUVFAoXG4gICAgICB0eXBlLFxuICAgICAgcmVzb3VyY2UsXG4gICAgICBwYXJhbXNcbiAgICApO1xuXG4gICAgb3B0aW9ucy5tZXRob2QgPSAnUE9TVCc7XG4gICAgaWYgKHR5cGVvZiAoaHR0cENsaWVudCkgPT09ICdmdW5jdGlvbicpIHsgLy8gc3VwcG9ydCBodHRwQ2xpZW50IGFyZ3VtZW50XG4gICAgICByZXR1cm4gaHR0cENsaWVudChzZXJ2ZXJFbmRwb2ludCArICcvdjEvcXVlcnknLCBvcHRpb25zKS50aGVuKHJlc3BvbnNlID0+XG4gICAgICAgIGNvbnZlcnRIVFRQUmVzcG9uc2UocmVzcG9uc2UuanNvbiwgdHlwZSwgcmVzb3VyY2UsIHBhcmFtcylcbiAgICAgICk7XG4gICAgfVxuXG4gICAgb3B0aW9ucy5oZWFkZXJzID0gaHR0cENsaWVudDsgLy8gYmFja3dhcmRzIGNvbXBhdGlibGUgc3RhdGljIGhlYWRlciBvYmplY3RcbiAgICByZXR1cm4gZmV0Y2goc2VydmVyRW5kcG9pbnQgKyAnL3YxL3F1ZXJ5Jywgb3B0aW9ucykudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCkudGhlbigoZGF0YSkgPT4ge1xuICAgICAgICByZXR1cm4gY29udmVydEhUVFBSZXNwb25zZShkYXRhLCB0eXBlLCByZXNvdXJjZSwgcGFyYW1zKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xufTtcbiIsIi8vIGRlZmluZSBoYXN1cmEganNvbiBhcGkgcXVlcmllc1xuY29uc3QgYnVsa1F1ZXJ5ID0ge1xuICB0eXBlOiAnYnVsaycsXG4gIGFyZ3M6IFtdXG59O1xuXG5jb25zdCBzZWxlY3RRdWVyeSA9IHtcbiAgdHlwZTogJ3NlbGVjdCcsXG4gIGFyZ3M6IHtcbiAgICB0YWJsZTogeydzY2hlbWEnOiAnJywgJ25hbWUnOiAnJ30sXG4gICAgY29sdW1uczogWycqJ11cbiAgfVxufTtcblxuY29uc3QgY291bnRRdWVyeSA9IHtcbiAgdHlwZTogJ2NvdW50JyxcbiAgYXJnczoge1xuICAgIHRhYmxlOiB7J3NjaGVtYSc6ICcnLCAnbmFtZSc6ICcnfSxcbiAgICB3aGVyZToge31cbiAgfVxufTtcblxuY29uc3QgaW5zZXJ0UXVlcnkgPSB7XG4gIHR5cGU6ICdpbnNlcnQnLFxuICBhcmdzOiB7XG4gICAgdGFibGU6IHsnc2NoZW1hJzogJycsICduYW1lJzogJyd9LFxuICAgIG9iamVjdHM6IFtdLFxuICAgIHJldHVybmluZzogW11cbiAgfVxufTtcblxuY29uc3QgdXBkYXRlUXVlcnkgPSB7XG4gIHR5cGU6ICd1cGRhdGUnLFxuICBhcmdzOiB7XG4gICAgdGFibGU6IHsnc2NoZW1hJzogJycsICduYW1lJzogJyd9LFxuICAgICRzZXQ6IHt9LFxuICAgIHdoZXJlOiB7fSxcbiAgICByZXR1cm5pbmc6IFtdXG4gIH1cbn07XG5cbmNvbnN0IGRlbGV0ZVF1ZXJ5ID0ge1xuICB0eXBlOiAnZGVsZXRlJyxcbiAgYXJnczoge1xuICAgIHRhYmxlOiB7J3NjaGVtYSc6ICcnLCAnbmFtZSc6ICcnfSxcbiAgICAkc2V0OiB7fSxcbiAgICB3aGVyZToge30sXG4gICAgcmV0dXJuaW5nOiBbXVxuICB9XG59O1xuXG5leHBvcnQgeyBidWxrUXVlcnksIHNlbGVjdFF1ZXJ5LCBjb3VudFF1ZXJ5LCBpbnNlcnRRdWVyeSwgdXBkYXRlUXVlcnksIGRlbGV0ZVF1ZXJ5IH07XG5cbiJdLCJzb3VyY2VSb290IjoiIn0=